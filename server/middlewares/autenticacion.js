/////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////VERIFICAR TOKEN////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////

const jwt = require('jsonwebtoken');

let verificadorToken = (req,res,next) => {

let token = req.get('token');

jwt.verify(token,process.env.TOKEN_SEED,(error,decoded)=>{

if(error){return res.status(401).json({ok:false,
                                       message:error})}

req.usuario = decoded.usuario;

next();})};

/////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////VERIFICAR ADMINISTRADOR//////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////

let verificaAdministrador = (req,res,next)=>{

let role = req.usuario.role;

if(role === 'ADMIN_ROLE'){next()}

else{res.status(401).json({ok:false,
                           message:`El usuario: ${req.usuario.nombre} no tiene permiso`})}}





/////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////VERIFICAR TOKEN IMG //////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////

let verificaTokenImg = (req,res,next)=>{

let token = req.query.token;

jwt.verify(token,process.env.TOKEN_SEED,(error,decoded)=>{

if(error){return res.status(401).json({ok:false,
                                       message:error})}

req.usuario = decoded.usuario;

next();});

}


module.exports = {verificadorToken,verificaAdministrador,verificaTokenImg};
